@page "/conducted-offers"

@inject ExchangeOrderService ExchangeOrderService
@inject NavigationManager Navigation
@inject UserService UserService

<MudTable Items="@conductedOffers" Hover="true" LoadingProgressColor="Color.Info" Style="width: 50%; margin: 0 25% 0 25%">
    <HeaderContent>
        <MudTh>Отдали</MudTh>
        <MudTh></MudTh>
        <MudTh>Получили</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd style="width: 280px; margin: 2%">
            <MudCard Outlined="true">
                @if (context.SenderEmail == UserService.CurrentUser.Email)
                {
                    <MudCardContent>
                        <MudImage Src=@("Images/" + @ExchangeOrderService.GetExchangeOrder(context.SenderExchangeOrderId).PhotoName) Elevation="25" Class="rounded-lg" Width="250" Height="150" />
                    </MudCardContent>
                    <MudCardActions style="display: flex; justify-content:center">
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="() => OpenOrderPage(context.SenderExchangeOrderId)">@ExchangeOrderService.GetExchangeOrder(context.SenderExchangeOrderId).Title</MudButton>
                    </MudCardActions>
                }
                else
                {
                    <MudCardContent>
                        <MudImage Src=@("Images/" + @ExchangeOrderService.GetExchangeOrder(context.RecipientExchangeOrderId).PhotoName) Elevation="25" Class="rounded-lg" Width="250" Height="150" />
                    </MudCardContent>
                    <MudCardActions style="display: flex; justify-content:center">
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="() => OpenOrderPage(context.RecipientExchangeOrderId)">@ExchangeOrderService.GetExchangeOrder(context.RecipientExchangeOrderId).Title</MudButton>
                    </MudCardActions>
                }

            </MudCard>
        </MudTd>
        <MudTd Style="display: flex; justify-content:center">     
                <MudImage Src="Images/rightArrow.png" Height="50" Style="margin: 90px 0 0 0" />
        </MudTd>
        <MudTd style="width: 280px; margin: 2%">
            <MudCard Outlined="true">
                @if (context.SenderEmail == UserService.CurrentUser.Email)
                {
                    <MudCardContent>
                        <MudImage Src=@("Images/" + @ExchangeOrderService.GetExchangeOrder(context.RecipientExchangeOrderId).PhotoName) Elevation="25" Class="rounded-lg" Width="250" Height="150" />
                    </MudCardContent>
                    <MudCardActions style="display: flex; justify-content:center">
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="() => OpenOrderPage(context.RecipientExchangeOrderId)">@ExchangeOrderService.GetExchangeOrder(context.RecipientExchangeOrderId).Title</MudButton>
                    </MudCardActions>
                }
                else
                {
                    <MudCardContent>
                        <MudImage Src=@("Images/" + @ExchangeOrderService.GetExchangeOrder(context.SenderExchangeOrderId).PhotoName) Elevation="25" Class="rounded-lg" Width="250" Height="150" />
                    </MudCardContent>
                    <MudCardActions style="display: flex; justify-content:center">
                        <MudButton Variant="Variant.Text" Color="Color.Primary" OnClick="() => OpenOrderPage(context.SenderExchangeOrderId)">@ExchangeOrderService.GetExchangeOrder(context.SenderExchangeOrderId).Title</MudButton>
                    </MudCardActions>
                }
            </MudCard>
        </MudTd>
    </RowTemplate>
</MudTable>




@code {
    public List<ExchangeOrderOffer> conductedOffers { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        conductedOffers = ExchangeOrderService.GetConductedExchangeOrderOffers(UserService.CurrentUser.Email);
    }

    public void OpenOrderPage(int id)
    {
        ExchangeOrderService.ChangeCurrentExchangeOrder(id);
        Navigation.NavigateTo("/order");
    }
}